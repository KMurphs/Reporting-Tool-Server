node {

    checkout scm

    env.REGISTRY_CREDS = credentials('canister-credentials')
    env.TEST_CONTAINER_NAME = "mysql_temp"
    env.TEST_PASSSWORD = "TestPassword!"

    tag = "latest"
    appName = "puzzle"
    registryHost = "cloud.canister.io:5000"
    imageName = "${registryHost}//${appName}:${tag}"

    stage "Build"

        sh "echo 'Building the Custom MYSQL Image'"
        sh "docker build -t ${imageName} -f k8s_applications/mysql/mysql-image/Dockerfile k8s_applications/mysql/mysql-image/"

    stage "Push"

        sh "docker push ${imageName}"

    stage "Deploy"

        kubernetesDeploy configs: "applications/${appName}/k8s/*.yaml", kubeconfigId: 'kenzan_kubeconfig'
}
